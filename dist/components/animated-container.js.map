{"version":3,"file":"animated-container.js","sources":["../../src/components/animated-container.hbs","../../src/components/animated-container.ts"],"sourcesContent":["import { precompileTemplate } from \"@ember/template-compilation\";\nexport default precompileTemplate(\"{{!--\\n  The @class is only there to support a deprecated usage.\\n--}}\\n{{#let (element this.tag) as |Tag|~}}\\n  {{! @glint-ignore: https://github.com/typed-ember/glint/issues/610 }}\\n  <Tag class=\\\"animated-container {{@class}}\\\" ...attributes>\\n    {{yield}}\\n  </Tag>\\n{{/let}}\")","import { inject as service } from '@ember/service';\nimport Component from '@ember/component';\nimport { alias } from '@ember/object/computed';\nimport { action } from '@ember/object';\nimport { Resize } from '../motions/resize.ts';\nimport { task, type Task } from '../-private/ember-scheduler.ts';\nimport Sprite from '../-private/sprite.ts';\nimport { afterRender, microwait } from '../-private/concurrency-helpers.ts';\nimport { componentNodes } from '../-private/ember-internals.ts';\nimport type MotionService from '../services/-ea-motion.ts';\nimport type { MotionConstructor } from '../-private/motion.ts';\n\ninterface AnimatedContainerSignature<Tag extends string> {\n  /** Multiple tags supported for base element via `tag` arg */\n  // Element: ElementFromTagName<Tag>; // @todo https://github.com/typed-ember/glint/issues/610\n  Element: HTMLDivElement;\n  Args: {\n    motion?: string;\n\n    /** Whether to animate the initial render. You will probably also need to set initialInsertion=true on a child component of animated-container. Defaults to false. */\n    onInitialRender?: boolean;\n\n    /** Use a custom tag for the container. Defaults to div. */\n    tag?: Tag;\n    class?: string;\n  };\n  Blocks: {\n    default: [];\n  };\n}\n\n/**\n Provides a boundary between animator components and the surrounding document\n which smoothly resizes as animators change. Use animated-container whenever you\n need to \"hold a place for\" some animated content while that content is animating.\n  ```hbs\n  <button {{on \"click\" this.toggleThing}}>Toggle</button>\n  <AnimatedContainer>\n    {{#animated-if this.showThing use=this.transition }}\n        <div class=\"message\" {{on \"click\" this.toggleThing}}>\n            Hello!\n        </div>\n    {{/animated-if}}\n  </AnimatedContainer>\n  <p>\n    This is outside of the container.\n  </p>\n  ```\n  ```js\n  import Component from '@ember/component';\n  import { action } from '@ember/object';\n  import { tracked } from '@glimmer/tracking';\n  import move from 'ember-animated/motions/move';\n  import { easeOut, easeIn } from 'ember-animated/easings/cosine';\n\n  export default class AnimatedContainerComponentExample extends Component {\n    @tracked showThing = false;\n\n    @action\n    toggleThing() {\n      this.showThing = !this.showThing;\n    }\n\n    *transition({ insertedSprites, keptSprites, removedSprites }) {\n      for (let sprite of insertedSprites) {\n        sprite.startAtPixel({ x: window.innerWidth });\n        yield move(sprite, { easing: easeOut });\n      }\n\n      for (let sprite of keptSprites) {\n        yield move(sprite);\n      }\n\n      for (let sprite of removedSprites) {\n        sprite.endAtPixel({ x: window.innerWidth });\n        yield move(sprite, { easing: easeIn });\n      }\n    }\n  }\n  ```\n  @class animated-container\n  @public\n*/\nexport default class AnimatedContainerComponent<\n  Tag extends string = 'div',\n> extends Component<AnimatedContainerSignature<Tag>> {\n  tagName = '';\n\n  @service('-ea-motion')\n  motionService!: MotionService;\n\n  /**\n   * Use a custom tag for the container. Defaults to div.\n    @argument tag\n    @type String\n  */\n  tag = 'div' as const;\n  // @todo https://github.com/typed-ember/glint/issues/610\n  // tag: Tag = 'div' as Tag;\n\n  /**\n   * Whether to animate the initial render. You will probably also need to set\n   * initialInsertion=true on a child component of animated-container.\n   * Defaults to false.\n    @argument onInitialRender\n    @type Boolean\n  */\n  onInitialRender = false;\n\n  /**\n   * Use a custom tag for the container. Defaults to div.\n    @argument motion\n    @type String\n  */\n  motion: MotionConstructor = Resize;\n\n  private _inserted = false;\n  private _startingUp = false;\n  private sprite: Sprite | null = null;\n\n  constructor(properties: Record<string, unknown> | undefined) {\n    super(properties);\n    this.motionService\n      .register(this as any)\n      .observeDescendantAnimations(this as any, this.maybeAnimate); // TODO: shouldn't need this cast;\n  }\n\n  didInsertElement() {\n    super.didInsertElement();\n    this._inserted = true;\n  }\n\n  private _ownElement() {\n    if (!this._inserted) {\n      return undefined;\n    }\n    let { firstNode, lastNode } = componentNodes(this);\n    let node: Node | null = firstNode;\n    while (node) {\n      if (node.nodeType === Node.ELEMENT_NODE) {\n        return node as HTMLElement | SVGElement;\n      }\n      if (node === lastNode) {\n        break;\n      }\n      node = node.nextSibling;\n    }\n    return undefined;\n  }\n\n  willDestroyElement() {\n    super.willDestroyElement();\n    this.motionService\n      .unregister(this as any)\n      .unobserveDescendantAnimations(this as any, this.maybeAnimate); // TODO: shouldn't need this cast\n  }\n\n  @alias('animated.isRunning')\n  isAnimating!: boolean;\n\n  @action\n  maybeAnimate({ duration, task }: { duration: number; task: Promise<void> }) {\n    if (!this._startingUp) {\n      this.animate.perform(duration, task);\n    }\n  }\n\n  beginStaticMeasurement() {\n    if (this.sprite) {\n      this.sprite.unlock();\n    }\n  }\n\n  endStaticMeasurement() {\n    if (this.sprite) {\n      this.sprite.lock();\n    }\n  }\n\n  @task(function* (\n    this: AnimatedContainerComponent,\n    duration: number,\n    animationTask: Promise<void>,\n  ) {\n    this._startingUp = true;\n    let service = this.motionService;\n    let sprite: Sprite;\n    let useMotion;\n    let element = this._ownElement();\n\n    if (element) {\n      sprite = Sprite.sizedStartingAt(element);\n      this.sprite = sprite;\n      sprite.lock();\n      useMotion = true;\n    } else {\n      useMotion = this.onInitialRender;\n    }\n\n    try {\n      yield afterRender();\n      yield microwait();\n    } finally {\n      this._startingUp = false;\n    }\n\n    yield* service.staticMeasurement(() => {\n      if (!sprite) {\n        // ownElement is non-null here because we waited for render above, and\n        // our own template definitely contains an Element\n        sprite = Sprite.sizedEndingAt(this._ownElement()!);\n        this.sprite = sprite;\n      } else {\n        sprite.measureFinalBounds();\n      }\n    });\n\n    if (useMotion) {\n      yield* new this.motion(this.sprite!, { duration })._run();\n    }\n\n    yield animationTask;\n\n    this.sprite!.unlock();\n    this.sprite = null;\n  }).restartable()\n  animate!: Task;\n}\n"],"names":["AnimatedContainerComponent","Component","tagName","f","this","service","i","void 0","tag","onInitialRender","motion","Resize","_inserted","_startingUp","sprite","constructor","properties","motionService","register","observeDescendantAnimations","maybeAnimate","didInsertElement","_ownElement","undefined","firstNode","lastNode","componentNodes","node","nodeType","Node","ELEMENT_NODE","nextSibling","willDestroyElement","unregister","unobserveDescendantAnimations","alias","duration","task","animate","perform","m","action","beginStaticMeasurement","unlock","endStaticMeasurement","lock","animationTask","useMotion","element","Sprite","sizedStartingAt","afterRender","microwait","staticMeasurement","sizedEndingAt","measureFinalBounds","_run","restartable","setComponentTemplate","TEMPLATE"],"mappings":"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"}